--DROP for testing in postman
DROP TABLE IF EXISTS FILMS_MPA;
DROP TABLE IF EXISTS MPA ;
DROP TABLE IF EXISTS FILMS_GENRES;
DROP TABLE IF EXISTS GENRES;
DROP TABLE IF EXISTS LIKES_FILM;
DROP TABLE IF EXISTS films;
DROP TABLE IF EXISTS users_friendship;
DROP TABLE IF EXISTS users;

CREATE TABLE IF NOT EXISTS films(
id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
name VARCHAR(50),
description VARCHAR(200),
release_date DATE,
duration INT);

CREATE TABLE IF NOT EXISTS genres(
genre_id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
genre_name VARCHAR(50));

CREATE TABLE IF NOT EXISTS films_genres(
id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
film_id INTEGER REFERENCES films(id) ON DELETE CASCADE,
genre_id INTEGER REFERENCES genres(genre_id) ON DELETE CASCADE);

CREATE TABLE IF NOT EXISTS mpa(
id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
mpa_name VARCHAR(10));

CREATE TABLE IF NOT EXISTS films_mpa(
film_id INTEGER PRIMARY KEY,
FOREIGN KEY (film_id) REFERENCES films(id),
mpa_id INTEGER REFERENCES mpa(id));

CREATE TABLE IF NOT EXISTS users(
id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
email VARCHAR(200),
login VARCHAR(200) NOT NULL,
name VARCHAR(200),
birthday DATE);

CREATE TABLE IF NOT EXISTS likes_film(
id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
film_id INTEGER REFERENCES films(id),
user_id INTEGER REFERENCES users(id)
);

CREATE TABLE IF NOT EXISTS users_friendship(
id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
user1_id INTEGER REFERENCES users(id),
user2_id INTEGER REFERENCES users(id),
mutually boolean
);

CREATE TABLE IF NOT EXISTS reviews(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    content VARCHAR NOT NULL,
    isPositive BOOLEAN NOT NULL,
    useful INTEGER NOT NULL,
    user_id INTEGER REFERENCES users(id),
    film_id INTEGER REFERENCES films(id)
);

CREATE TABLE IF NOT EXISTS likes_review(
    review_id INTEGER REFERENCES reviews(id),
    user_id INTEGER REFERENCES users(id),
    grade INTEGER CHECK (grade = -1 OR grade = 1)
);
